<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hospital Chatbot</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
      padding: 0;
      background: #f0f2f5;
    }

    #toggleBtn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 1000;
      background: #007bff;
      color: white;
      border: none;
      width: 55px;
      height: 55px;
      border-radius: 50%;
      font-size: 26px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      cursor: pointer;
    }

    #chat-container {
      position: fixed;
      bottom: 90px;
      right: 20px;
      width: 350px;
      height: 550px;
      border-radius: 20px;
      overflow: hidden;
      display: none;
      flex-direction: column;
      background: #fff;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      z-index: 999;
    }

    header {
      background: linear-gradient(135deg, #007bff, #3f88f7);
      color: white;
      padding: 15px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    header img {
      border-radius: 50%;
      width: 40px;
      height: 40px;
    }

    .title {
      font-weight: 600;
      font-size: 16px;
      margin-left: 10px;
    }

    #closeBtn {
      background: none;
      border: none;
      font-size: 20px;
      color: white;
      cursor: pointer;
    }

    #chatbox {
      flex: 1;
      overflow-y: auto;
      padding: 15px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      background: #f9f9f9;
    }

    .bot, .user {
      padding: 10px 14px;
      border-radius: 16px;
      font-size: 14px;
      max-width: 80%;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    .bot {
      background: #e9efff;
      align-self: flex-start;
    }

    .user {
      background: #007bff;
      color: white;
      align-self: flex-end;
    }

    #controls {
      display: flex;
      padding: 10px;
      border-top: 1px solid #ddd;
      background: white;
    }

    input[type="text"] {
      flex: 1;
      border: none;
      border-radius: 20px;
      padding: 10px 14px;
      font-size: 14px;
      background: #f1f1f1;
    }

    button {
      background: #007bff;
      color: white;
      border: none;
      margin-left: 8px;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    button:active {
      transform: scale(0.96);
    }

    #chatbox::-webkit-scrollbar {
      width: 6px;
    }

    #chatbox::-webkit-scrollbar-thumb {
      background-color: rgba(0,0,0,0.1);
      border-radius: 10px;
    }
  </style>
</head>
<body>

<button id="toggleBtn">üí¨</button>

<div id="chat-container">
  <header>
    <div style="display: flex; align-items: center;">
      <img src="https://i.imgur.com/3GvwNBf.png" alt="Bot Avatar"/>
      <div class="title">Chat with MedBot</div>
    </div>
    <button id="closeBtn">√ó</button>
  </header>

  <div id="chatbox"></div>

  <div id="controls">
    <input type="text" id="userInput" placeholder="Type or speak..." />
    <button onclick="sendMessage()">‚û§</button>
    <button id="micBtn">üéôÔ∏è</button>
  </div>
</div>

<script src="https://cdn.socket.io/4.3.2/socket.io.min.js"></script>
<script>
  const socket = io("http://localhost:5000");
  socket.on("connect", () =>{
   console.log("‚úÖ Connected to backend")
   // Auto-send greeting trigger
    socket.emit("user_message", "start");  // Or "hello", or "" if you want
  });
  socket.on("disconnect", () => console.warn("‚ö†Ô∏è Disconnected from backend"));

  const chatbox = document.getElementById("chatbox");
  const input = document.getElementById("userInput");
  const toggleBtn = document.getElementById("toggleBtn");
  const chatContainer = document.getElementById("chat-container");
  const closeBtn = document.getElementById("closeBtn");
  const micBtn = document.getElementById("micBtn");

    input.addEventListener("keypress", function (event) {
        if (event.key === "Enter") {
            event.preventDefault();    // prevent default form submission
            sendMessage();             // call your send function
        }
    });

    function sendMessage() {
        const message = input.value.trim();
        if (message !== "") {
            socket.emit("user_message", message);
            input.value = "";  // Clear the input field
        }
    }
  toggleBtn.onclick = () => {
    chatContainer.style.display = chatContainer.style.display === "flex" ? "none" : "flex";
  };
  closeBtn.onclick = () => chatContainer.style.display = "none";

  function appendMessage(sender, message) {
    const div = document.createElement("div");
    div.className = sender;
    div.innerHTML = message.replace(/\n/g, "<br>");
    chatbox.appendChild(div);
    chatbox.scrollTop = chatbox.scrollHeight;
  }

  function sendMessage() {
    const msg = input.value.trim();
    if (!msg) return;
    appendMessage("user", msg);
    socket.emit("user_message", msg);
    input.value = "";
  }

  socket.on("bot_response", function (msg) {
    appendMessage("bot", msg);
  });

  // üéôÔ∏è Voice recognition setup
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  const recognition = new SpeechRecognition();
  recognition.lang = 'en-US';
  recognition.continuous = false;
  recognition.interimResults = false;
  let micAskedOnce = false;

  micBtn.addEventListener("click", () => {
    if (!micAskedOnce) {
      alert("üéôÔ∏è Please allow mic access for voice input.");
      micAskedOnce = true;
    }
    recognition.stop();  // Stop if already running
    recognition.start();
  });

  recognition.onresult = function (event) {
    const transcript = event.results[0][0].transcript.trim();
    console.log("üé§ Transcript:", transcript);

    if (transcript !== "") {
      input.value = transcript;  // Optional: show in input
      appendMessage("user", transcript);
      socket.emit("user_message", transcript);
    }
  };

  recognition.onerror = function (event) {
    console.error("üéôÔ∏è Voice recognition error:", event.error);
  };
</script>


</body>
</html>
